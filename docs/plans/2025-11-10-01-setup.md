# Plan 01: Project Setup & Configuration

**Date:** 2025-11-10
**Goal:** Configure Next.js 16 app with Cache Components enabled, create folder structure, and set up base navigation

---

## Overview

Set up the foundation for the Next.js Cache & MCP Learning App. This includes:
- Enabling Cache Components in Next.js config
- Creating the folder structure for all cache demos
- Building a base layout with tab navigation
- Adding basic styling foundation

---

## Implementation Steps

### Step 1: Enable Cache Components in next.config.ts

**Location:** `my-app/next.config.ts`

**Action:** Add `cacheComponents: true` to experimental config

```typescript
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  experimental: {
    // Enable Cache Components - NEW in Next.js 16
    // This changes default behavior: routes are dynamic by default
    // Must use 'use cache' directive to opt-in to caching
    cacheComponents: true,
  },
};

export default nextConfig;
```

**Why:** Cache Components is the new caching paradigm in Next.js 16. Enabling this allows us to use:
- `'use cache'` directive
- `cacheLife()` profiles
- `cacheTag()` for invalidation
- `updateTag()` for immediate expiration

---

### Step 2: Create Folder Structure

**Location:** `my-app/app/`

**Create the following directories:**

```
my-app/app/
â”œâ”€â”€ (dashboard)/                    # Route group (not in URL)
â”‚   â”œâ”€â”€ layout.tsx                  # Shared layout with tab navigation
â”‚   â”œâ”€â”€ page.tsx                    # Dashboard home/overview
â”‚   â”œâ”€â”€ request-memoization/
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ data-cache/
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ full-route-cache/
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ router-cache/
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ cache-components/
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ invalidation/
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ mcp-showcase/
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â””â”€â”€ v15-vs-v16/
â”‚       â””â”€â”€ page.tsx
â”œâ”€â”€ api/                            # Route Handlers for data sources
â”‚   â””â”€â”€ (will be created in Plan 10)
â”œâ”€â”€ components/                     # Shared components
â”‚   â””â”€â”€ (will be created in Plan 11)
â”œâ”€â”€ actions/                        # Server Actions
â”‚   â””â”€â”€ cache-actions.ts
â””â”€â”€ types/
    â””â”€â”€ cache.ts
```

**Commands to run:**

```bash
cd my-app/app

# Create route group and subdirectories
mkdir -p "(dashboard)"/{request-memoization,data-cache,full-route-cache,router-cache,cache-components,invalidation,mcp-showcase,v15-vs-v16}

# Create other directories
mkdir -p api components actions types
```

---

### Step 3: Create Dashboard Layout with Tab Navigation

**Location:** `my-app/app/(dashboard)/layout.tsx`

**Action:** Create shared layout with horizontal tab navigation

```typescript
import Link from 'next/link';
import { ReactNode } from 'react';

// This layout wraps all dashboard routes
// Provides consistent navigation across cache demos
export default function DashboardLayout({
  children,
}: {
  children: ReactNode;
}) {
  return (
    <div className="min-h-screen bg-background text-foreground">
      {/* Header with app title */}
      <header className="border-b border-gray-200 dark:border-gray-800">
        <div className="container mx-auto px-4 py-4">
          <h1 className="text-2xl font-bold">
            Next.js 16 Cache & MCP Learning Lab
          </h1>
          <p className="text-sm text-gray-600 dark:text-gray-400 mt-1">
            Explore caching mechanisms, invalidation strategies, and MCP integration
          </p>
        </div>
      </header>

      {/* Tab navigation - horizontal scroll on mobile */}
      <nav className="border-b border-gray-200 dark:border-gray-800 overflow-x-auto">
        <div className="container mx-auto px-4">
          <div className="flex gap-4 py-3 min-w-max">
            <TabLink href="/" label="Overview" />
            <TabLink href="/request-memoization" label="Request Memo" />
            <TabLink href="/data-cache" label="Data Cache" />
            <TabLink href="/full-route-cache" label="Route Cache" />
            <TabLink href="/router-cache" label="Router Cache" />
            <TabLink href="/cache-components" label="Cache Components" />
            <TabLink href="/invalidation" label="Invalidation" />
            <TabLink href="/mcp-showcase" label="MCP" />
            <TabLink href="/v15-vs-v16" label="v15 vs v16" />
          </div>
        </div>
      </nav>

      {/* Main content area */}
      <main className="container mx-auto px-4 py-8">
        {children}
      </main>

      {/* Footer with helpful info */}
      <footer className="border-t border-gray-200 dark:border-gray-800 mt-12">
        <div className="container mx-auto px-4 py-6 text-center text-sm text-gray-600 dark:text-gray-400">
          <p>Built with Next.js 16 â€¢ React 19 â€¢ Cache Components Enabled</p>
        </div>
      </footer>
    </div>
  );
}

// Helper component for tab links
// Will add active state styling in Plan 11
function TabLink({ href, label }: { href: string; label: string }) {
  return (
    <Link
      href={href}
      className="px-3 py-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors whitespace-nowrap"
    >
      {label}
    </Link>
  );
}
```

---

### Step 4: Create Dashboard Overview Page

**Location:** `my-app/app/(dashboard)/page.tsx`

**Action:** Create landing page explaining the app and cache layers

```typescript
export default function DashboardOverview() {
  return (
    <div className="max-w-4xl mx-auto">
      <h2 className="text-3xl font-bold mb-6">Welcome to the Cache Learning Lab</h2>

      <div className="space-y-6">
        {/* Introduction */}
        <section className="p-6 border border-gray-200 dark:border-gray-800 rounded-lg">
          <h3 className="text-xl font-semibold mb-3">What You'll Learn</h3>
          <p className="text-gray-600 dark:text-gray-400 mb-4">
            This interactive app demonstrates Next.js 16 caching mechanisms,
            invalidation strategies, and MCP (Model Context Protocol) integration.
          </p>
          <p className="text-gray-600 dark:text-gray-400">
            Each tab explores a different caching layer with live examples,
            timestamps, and interactive controls to help you understand how
            caching works in production Next.js applications.
          </p>
        </section>

        {/* Cache Layers Overview */}
        <section className="p-6 border border-gray-200 dark:border-gray-800 rounded-lg">
          <h3 className="text-xl font-semibold mb-3">Next.js Caching Layers</h3>
          <div className="space-y-3">
            <CacheLayer
              number={1}
              title="Request Memoization"
              description="React feature: deduplicates fetch requests within a single render pass"
              scope="Component tree"
            />
            <CacheLayer
              number={2}
              title="Data Cache"
              description="Server-side persistent cache for fetch() responses across requests"
              scope="Server (per-deployment)"
            />
            <CacheLayer
              number={3}
              title="Full Route Cache"
              description="Caches rendered HTML + RSC payload for static routes at build time"
              scope="Server (per-deployment)"
            />
            <CacheLayer
              number={4}
              title="Router Cache"
              description="Client-side in-memory cache of visited route segments"
              scope="Client (per-session)"
            />
            <CacheLayer
              number={5}
              title="Cache Components"
              description="NEW in v16: 'use cache' directive for caching pages/components/functions"
              scope="Server (configurable with cacheLife)"
            />
          </div>
        </section>

        {/* Instructions */}
        <section className="p-6 border border-gray-200 dark:border-gray-800 rounded-lg">
          <h3 className="text-xl font-semibold mb-3">How to Use This App</h3>
          <ol className="list-decimal list-inside space-y-2 text-gray-600 dark:text-gray-400">
            <li>Navigate through tabs to explore each caching mechanism</li>
            <li>Check timestamps to understand cache hits vs misses</li>
            <li>Click invalidation buttons to see cache clearing in action</li>
            <li>Read inline code comments (in browser DevTools sources) for explanations</li>
            <li>Compare v15 vs v16 behavior in the last tab</li>
          </ol>
        </section>

        {/* Getting Started */}
        <section className="p-6 bg-blue-50 dark:bg-blue-950 border border-blue-200 dark:border-blue-800 rounded-lg">
          <h3 className="text-xl font-semibold mb-3">ðŸ‘‰ Start Here</h3>
          <p className="text-gray-700 dark:text-gray-300 mb-3">
            Begin with <strong>Request Memoization</strong> tab to understand
            the most basic caching layer, then progress through each tab sequentially.
          </p>
          <p className="text-sm text-gray-600 dark:text-gray-400">
            Tip: Open your browser DevTools Network tab to observe fetch requests
            and caching behavior in real-time.
          </p>
        </section>
      </div>
    </div>
  );
}

// Helper component for cache layer cards
function CacheLayer({
  number,
  title,
  description,
  scope,
}: {
  number: number;
  title: string;
  description: string;
  scope: string;
}) {
  return (
    <div className="flex gap-4 p-4 bg-gray-50 dark:bg-gray-900 rounded-md">
      <div className="flex-shrink-0 w-8 h-8 rounded-full bg-blue-500 text-white flex items-center justify-center font-bold">
        {number}
      </div>
      <div className="flex-1">
        <h4 className="font-semibold mb-1">{title}</h4>
        <p className="text-sm text-gray-600 dark:text-gray-400 mb-1">
          {description}
        </p>
        <p className="text-xs text-gray-500 dark:text-gray-500">
          Scope: {scope}
        </p>
      </div>
    </div>
  );
}
```

---

### Step 5: Create Types File

**Location:** `my-app/app/types/cache.ts`

**Action:** Define TypeScript types for cache demos

```typescript
// Shared types for cache demonstrations

// Represents the status of a cache operation
export type CacheStatus = 'HIT' | 'MISS' | 'STALE' | 'REVALIDATING';

// Timestamp information for cache demos
export interface CacheTimestamp {
  fetchedAt: string;      // ISO timestamp when data was fetched
  displayedAt: string;    // ISO timestamp when component rendered
  cacheStatus: CacheStatus;
}

// Data fetched from external API (JSONPlaceholder)
export interface Post {
  userId: number;
  id: number;
  title: string;
  body: string;
}

export interface User {
  id: number;
  name: string;
  email: string;
  username: string;
}

// Response from our internal mock API
export interface MockApiResponse<T> {
  data: T;
  timestamp: string;
  cached: boolean;
  source: 'api' | 'cache';
}

// Cache life profiles (used with 'use cache' directive)
export type CacheLifeProfile = 'seconds' | 'minutes' | 'hours' | 'days' | 'weeks' | 'max';
```

---

### Step 6: Create Placeholder Server Actions File

**Location:** `my-app/app/actions/cache-actions.ts`

**Action:** Create file for cache invalidation Server Actions (implementations in Plan 07)

```typescript
'use server';

// Server Actions for cache invalidation
// These will be called from client components via buttons
// Implementations will be added in Plan 07 (Invalidation)

import { revalidatePath } from 'next/cache';
import { revalidateTag } from 'next/cache';

/**
 * Revalidates a specific path, clearing Data Cache + Full Route Cache
 * Can be called from any client component
 */
export async function revalidatePathAction(path: string) {
  // Implementation in Plan 07
}

/**
 * Revalidates all cache entries with a specific tag
 * Uses stale-while-revalidate strategy
 */
export async function revalidateTagAction(tag: string) {
  // Implementation in Plan 07
}

/**
 * Immediately expires cache for read-your-own-writes scenarios
 * Only works in Server Actions (not Route Handlers)
 */
export async function updateTagAction(tag: string) {
  // Implementation in Plan 07
}
```

---

## Expected Result After Completion

### What You Should See

1. **Dev server starts successfully** with Cache Components enabled
2. **Dashboard layout renders** with horizontal tab navigation
3. **Overview page displays** with cache layer explanations
4. **All tabs are accessible** (will show empty pages until Plans 2-9 are implemented)
5. **No console errors** in browser or terminal

### File Structure

```
my-app/
â”œâ”€â”€ next.config.ts                  # âœ… cacheComponents: true
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ (dashboard)/
â”‚   â”‚   â”œâ”€â”€ layout.tsx              # âœ… Tab navigation + footer
â”‚   â”‚   â”œâ”€â”€ page.tsx                # âœ… Overview page
â”‚   â”‚   â”œâ”€â”€ request-memoization/    # âœ… Created (empty)
â”‚   â”‚   â”œâ”€â”€ data-cache/             # âœ… Created (empty)
â”‚   â”‚   â”œâ”€â”€ full-route-cache/       # âœ… Created (empty)
â”‚   â”‚   â”œâ”€â”€ router-cache/           # âœ… Created (empty)
â”‚   â”‚   â”œâ”€â”€ cache-components/       # âœ… Created (empty)
â”‚   â”‚   â”œâ”€â”€ invalidation/           # âœ… Created (empty)
â”‚   â”‚   â”œâ”€â”€ mcp-showcase/           # âœ… Created (empty)
â”‚   â”‚   â””â”€â”€ v15-vs-v16/             # âœ… Created (empty)
â”‚   â”œâ”€â”€ actions/
â”‚   â”‚   â””â”€â”€ cache-actions.ts        # âœ… Placeholder functions
â”‚   â””â”€â”€ types/
â”‚       â””â”€â”€ cache.ts                # âœ… TypeScript types
```

---

## Testing Steps

### 1. Start Development Server

```bash
cd my-app
npm run dev
```

**Expected:** Server starts on http://localhost:3000 with no errors

### 2. Visit Dashboard

Open http://localhost:3000

**Expected:**
- Overview page renders with cache layers explanation
- Tab navigation is visible and clickable
- Footer shows "Cache Components Enabled"

### 3. Test Navigation

Click through all tabs

**Expected:**
- URL updates for each tab
- Empty pages render without errors (will be filled in later plans)
- Tab navigation remains visible and functional

### 4. Check Config

Verify Cache Components is enabled:

```bash
# Check next.config.ts
cat my-app/next.config.ts | grep cacheComponents
```

**Expected:** Output shows `cacheComponents: true`

### 5. Verify Folder Structure

```bash
cd my-app/app
ls -la "(dashboard)"
ls -la actions
ls -la types
```

**Expected:** All folders exist with correct files

---

## Common Issues & Troubleshooting

### Issue: "Cannot find module '(dashboard)'"

**Cause:** Route groups must be in quotes in terminal commands
**Fix:** Use `"(dashboard)"` not `(dashboard)` when creating folders

### Issue: Cache Components not working

**Cause:** Next.js version < 16 or config typo
**Fix:**
```bash
npm list next
# Should show 16.x.x or higher
```
Check `next.config.ts` for typos in `experimental.cacheComponents`

### Issue: TypeScript errors in layout

**Cause:** Missing ReactNode import
**Fix:** Ensure `import { ReactNode } from 'react';` at top of layout.tsx

---

## Next Steps

After completing this plan:
- âœ… Foundation is set up
- âœ… Navigation works across all tabs
- â­ï¸ **Plan 02:** Implement Request Memoization demo
- â­ï¸ **Plan 03:** Implement Data Cache demo
- ...continue through Plan 11

---

## Key Concepts Learned

- **Cache Components:** New opt-in caching paradigm in Next.js 16
- **Route Groups:** `(dashboard)` creates shared layout without affecting URLs
- **Experimental Config:** `cacheComponents: true` enables 'use cache' directive
- **Server Actions:** Functions marked with 'use server' for cache invalidation
- **TypeScript Types:** Shared types improve code quality and DX

---

**Status:** Ready for implementation
**Dependencies:** None (this is the foundation)
**Estimated Time:** 20-30 minutes
