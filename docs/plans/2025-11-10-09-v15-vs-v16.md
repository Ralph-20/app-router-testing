# Plan 09: Next.js 15 vs 16 Comparison

**Date:** 2025-11-10
**Goal:** Side-by-side comparison of caching behavior changes between Next.js 15 and 16

---

## Overview

Major caching changes in Next.js 16:

1. **fetch() default:** Cached by default (v15) → Uncached by default (v16)
2. **Route default:** Static by default (v15) → Dynamic with Cache Components (v16)
3. **Caching paradigm:** Route-level (v15) → Component-level with 'use cache' (v16)
4. **Config:** `fetchCache`, `dynamic` (v15) → `cacheComponents`, 'use cache' (v16)

---

## Implementation Steps

### Step 1: Create Comparison Page

**Location:** `my-app/app/(dashboard)/v15-vs-v16/page.tsx`

```typescript
export default function V15vsV16Page() {
  return (
    <div className="max-w-6xl mx-auto space-y-8">
      <section>
        <h2 className="text-3xl font-bold mb-4">Next.js 15 vs 16 Comparison</h2>
        <p className="text-gray-600 dark:text-gray-400">
          Major caching behavior changes between versions
        </p>
      </section>

      {/* fetch() Default Change */}
      <ComparisonSection
        title="1. fetch() Default Behavior"
        v15Behavior="Cached by default (opt-out with cache: 'no-store')"
        v16Behavior="Uncached by default (opt-in with cache: 'force-cache')"
        v15Code={`// Next.js 15
const data = await fetch(url);
// ↑ Automatically cached`}
        v16Code={`// Next.js 16
const data = await fetch(url);
// ↑ NOT cached (must opt-in)

const cached = await fetch(url, {
  cache: 'force-cache' // Explicit opt-in
});`}
        impact="Breaking: APIs that relied on automatic caching need explicit cache: 'force-cache'"
      />

      {/* Route Default Change */}
      <ComparisonSection
        title="2. Route Rendering Default"
        v15Behavior="Static by default (opt-out with dynamic APIs or dynamic='force-dynamic')"
        v16Behavior="Dynamic by default with Cache Components enabled (opt-in with 'use cache')"
        v15Code={`// Next.js 15
export default async function Page() {
  // ↑ Static by default, cached at build time
  return <div>Static content</div>;
}`}
        v16Code={`// Next.js 16 (Cache Components enabled)
export default async function Page() {
  // ↑ Dynamic by default, renders per-request
  return <div>Dynamic content</div>;
}

// Opt-in to caching:
export default async function Page() {
  'use cache'; // NEW directive
  cacheLife('hours');
  return <div>Cached content</div>;
}`}
        impact="Routes that were static in v15 become dynamic in v16 unless you add 'use cache'"
      />

      {/* Route Config Changes */}
      <ComparisonSection
        title="3. Cache Configuration"
        v15Behavior="Route segment config: export const fetchCache, dynamic, revalidate"
        v16Behavior="'use cache' directive + cacheLife() + cacheTag() for granular control"
        v15Code={`// Next.js 15 - Route segment config
export const fetchCache = 'force-cache';
export const dynamic = 'force-static';
export const revalidate = 3600;

export default async function Page() {
  // Entire route uses these settings
}`}
        v16Code={`// Next.js 16 - Component-level control
export default async function Page() {
  'use cache';
  cacheLife('hours'); // 1 hour
  cacheTag('my-page');

  return <div>Cached page</div>;
}

// Can also cache individual components:
async function MyComponent() {
  'use cache';
  cacheLife('minutes');
  // Only this component cached
}`}
        impact="More granular: cache individual components vs entire routes"
      />

      {/* Caching Scope */}
      <ComparisonSection
        title="4. Caching Scope"
        v15Behavior="Page/route level only - all or nothing"
        v16Behavior="Page, component, or function level - mix cached and uncached"
        v15Code={`// Next.js 15
// Can't mix: entire route is static or dynamic
export default async function Page() {
  const static1 = await fetchStatic();
  const static2 = await fetchStatic();
  // Both cached or both uncached
}`}
        v16Code={`// Next.js 16
export default async function Page() {
  // Uncached by default
  const live = await fetchLiveData();

  return (
    <div>
      <LiveSection data={live} />
      <CachedSection /> {/* This cached */}
    </div>
  );
}

async function CachedSection() {
  'use cache';
  const data = await expensiveQuery();
  return <div>{data}</div>;
}`}
        impact="Can optimize selectively: cache expensive parts, keep rest dynamic"
      />

      {/* Migration Guide */}
      <section className="p-6 border border-purple-200 dark:border-purple-800 rounded-lg">
        <h3 className="text-xl font-semibold mb-4">Migration Checklist</h3>
        <div className="space-y-3 text-sm">
          <MigrationItem
            checked
            title="Update fetch() calls"
            description="Add { cache: 'force-cache' } to fetches that should be cached"
          />
          <MigrationItem
            checked
            title="Review static routes"
            description="Add 'use cache' to pages that should remain static"
          />
          <MigrationItem
            checked
            title="Enable Cache Components"
            description="Set experimental.cacheComponents = true in next.config.ts"
          />
          <MigrationItem
            checked
            title="Replace route segment config"
            description="Convert fetchCache/dynamic exports to 'use cache' directives"
          />
          <MigrationItem
            checked
            title="Test cache behavior"
            description="Verify pages cached/dynamic as expected"
          />
        </div>
      </section>
    </div>
  );
}

function ComparisonSection({
  title,
  v15Behavior,
  v16Behavior,
  v15Code,
  v16Code,
  impact,
}: {
  title: string;
  v15Behavior: string;
  v16Behavior: string;
  v15Code: string;
  v16Code: string;
  impact: string;
}) {
  return (
    <section className="border rounded-lg overflow-hidden">
      <div className="p-4 bg-gray-50 dark:bg-gray-900">
        <h3 className="text-lg font-semibold">{title}</h3>
      </div>

      <div className="grid grid-cols-1 md:grid-cols-2 divide-y md:divide-y-0 md:divide-x divide-gray-200 dark:divide-gray-700">
        {/* v15 */}
        <div className="p-6">
          <div className="flex items-center gap-2 mb-3">
            <span className="text-xs px-2 py-1 bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 rounded">
              Next.js 15
            </span>
          </div>
          <p className="text-sm text-gray-600 dark:text-gray-400 mb-4">{v15Behavior}</p>
          <pre className="text-xs bg-gray-900 text-gray-100 p-3 rounded overflow-x-auto">
            {v15Code}
          </pre>
        </div>

        {/* v16 */}
        <div className="p-6">
          <div className="flex items-center gap-2 mb-3">
            <span className="text-xs px-2 py-1 bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 rounded">
              Next.js 16
            </span>
          </div>
          <p className="text-sm text-gray-600 dark:text-gray-400 mb-4">{v16Behavior}</p>
          <pre className="text-xs bg-gray-900 text-gray-100 p-3 rounded overflow-x-auto">
            {v16Code}
          </pre>
        </div>
      </div>

      <div className="p-4 bg-yellow-50 dark:bg-yellow-950 border-t border-yellow-200 dark:border-yellow-800">
        <p className="text-sm text-gray-700 dark:text-gray-300">
          <strong>Impact:</strong> {impact}
        </p>
      </div>
    </section>
  );
}

function MigrationItem({
  checked,
  title,
  description,
}: {
  checked: boolean;
  title: string;
  description: string;
}) {
  return (
    <div className="flex items-start gap-3">
      <input
        type="checkbox"
        checked={checked}
        readOnly
        className="mt-1"
      />
      <div>
        <div className="font-semibold">{title}</div>
        <div className="text-xs text-gray-600 dark:text-gray-400">{description}</div>
      </div>
    </div>
  );
}
```

---

## Expected Results

- Clear side-by-side comparison of v15 vs v16
- Code examples show exact differences
- Migration checklist helps upgrade
- Impact statements explain breaking changes

---

## Testing

1. Visit `/v15-vs-v16`
2. Review all 4 comparison sections
3. Understand migration requirements
4. Reference when upgrading projects

---

**Status:** Ready
**Time:** 30 min
